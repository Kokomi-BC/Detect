# Python API é›†æˆ - è¾¹æƒ³è¾¹æœåŠŸèƒ½

æœ¬é¡¹ç›®å®ç°äº†ä» Node.jsï¼ˆJavaScriptï¼‰åˆ° Python çš„è·¨è¯­è¨€é›†æˆï¼Œæ”¯æŒä½¿ç”¨ç«å±±æ–¹èˆŸï¼ˆDoubaoï¼‰å¤§è¯­è¨€æ¨¡å‹çš„"è¾¹æƒ³è¾¹æœ"åŠŸèƒ½è¿›è¡Œå†…å®¹çœŸå®æ€§åˆ†æã€‚

## åŠŸèƒ½ç‰¹æ€§

âœ… **è·¨è¯­è¨€æ•°æ®ä¼ è¾“**
- JavaScript åˆ° Python çš„æ— ç¼æ•°æ®è¿ç§»
- UTF-8 ç¼–ç ä¿è¯ä¸­æ–‡å­—ç¬¦æ­£ç¡®ä¼ è¾“
- æ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡ï¼ˆbase64 æˆ– URLï¼‰å¤šæ¨¡æ€æ•°æ®

âœ… **è¾¹æƒ³è¾¹æœåŠŸèƒ½**
- AI å®æ—¶æ€è€ƒè¿‡ç¨‹å±•ç¤º
- è‡ªåŠ¨è§¦å‘ç½‘ç»œæœç´¢éªŒè¯ä¿¡æ¯
- æµå¼å“åº”å®æ—¶åé¦ˆ
- æœç´¢ç»“æœå¼•ç”¨è¿½è¸ª

âœ… **æ€§èƒ½ä¼˜åŒ–**
- Python è¿›ç¨‹æ± ç®¡ç†ï¼ˆé¿å…é¢‘ç¹åˆ›å»ºè¿›ç¨‹ï¼‰
- å¼‚æ­¥éé˜»å¡è°ƒç”¨
- è¯·æ±‚é˜Ÿåˆ—å¹¶å‘æ§åˆ¶
- è‡ªåŠ¨é‡è¯•æœºåˆ¶

âœ… **æ•°æ®å®Œæ•´æ€§**
- JSON åºåˆ—åŒ–/ååºåˆ—åŒ–å®Œæ•´æ€§æ£€æŸ¥
- UTF-8 ç¼–ç è‡ªåŠ¨æ£€æµ‹å’Œè½¬æ¢
- æ•°æ®æ ¡éªŒé˜²æ­¢ä¼ è¾“æŸå
- é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Node.js ä¾èµ–
npm install

# å®‰è£… Python ä¾èµ–
npm run setup:python
# æˆ–è€…åœ¨ Windows ä¸Š
npm run setup:python:win
```

### 2. é…ç½® API å¯†é’¥

è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export ARK_API_KEY="your-api-key-here"
```

æˆ–åˆ›å»º `.env` æ–‡ä»¶ï¼š

```
ARK_API_KEY=your-api-key-here
```

### 3. è¿è¡Œåº”ç”¨

```bash
npm run dev
```

## æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯UI    â”‚
â”‚ (Renderer)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ IPC
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»è¿›ç¨‹    â”‚
â”‚   (Main)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLMService  â”‚
â”‚  (Node.js)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PythonBridge â”‚
â”‚ è¿›ç¨‹æ± ç®¡ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ spawn
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Python    â”‚
â”‚ LLM Service â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç«å±±æ–¹èˆŸAPI â”‚
â”‚  (Doubao)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```javascript
const LLMService = require('./src/main/llmService');
const service = new LLMService();

// åˆ†ææ–‡æœ¬å†…å®¹
const result = await service.analyzeContent(
  "æ–°é—»æ–‡æœ¬å†…å®¹",
  [],           // å›¾ç‰‡ URLs
  "",           // æ¥æº URL
  true,         // ä½¿ç”¨ç½‘ç»œæœç´¢
  false         // ä¸ä½¿ç”¨æµå¼å“åº”
);

console.log(result);
```

### æµå¼å“åº”

```javascript
const service = new LLMService();

// ç›‘å¬å®æ—¶äº‹ä»¶
service.on('event', (event) => {
  switch(event.type) {
    case 'thinking_delta':
      console.log('ğŸ¤” AI æ€è€ƒ:', event.data.delta);
      break;
    case 'search_query':
      console.log('ğŸ” æœç´¢:', event.data.query);
      break;
    case 'answer_delta':
      console.log('ğŸ’¬ å›ç­”:', event.data.delta);
      break;
  }
});

// å¼€å§‹æµå¼åˆ†æ
const result = await service.analyzeContent(
  "æ–°é—»æ–‡æœ¬å†…å®¹",
  [],
  "",
  true,   // ä½¿ç”¨ç½‘ç»œæœç´¢
  true    // ä½¿ç”¨æµå¼å“åº”
);
```

### å¤šæ¨¡æ€åˆ†æï¼ˆæ–‡æœ¬+å›¾ç‰‡ï¼‰

```javascript
const result = await service.analyzeContent(
  "æ–°é—»æ–‡æœ¬å†…å®¹",
  [
    "http://example.com/image1.jpg",
    "data:image/jpeg;base64,/9j/4AAQ..."
  ],
  "http://example.com/news",
  true,
  false
);
```

## è¿”å›æ•°æ®æ ¼å¼

```javascript
{
  "success": true,
  "probability": 0.85,           // çœŸå®æ€§æ¦‚ç‡ (0-1)
  "type": 1,                     // 1: çœŸ, 2: éƒ¨åˆ†å‡, 3: å‡
  "explanation": "åˆ¤æ–­ç†ç”±",
  "analysis_points": [           // åˆ†æè¦ç‚¹
    {
      "description": "å†…å®¹æ¥æºå¯é ",
      "status": "positive"       // positive/warning/negative
    }
  ],
  "fake_parts": [                // è™šå‡éƒ¨åˆ†ï¼ˆä»… type=2,3ï¼‰
    {
      "text": "è™šå‡ç‰‡æ®µ",
      "reason": "è™šå‡åŸå› "
    }
  ],
  "search_references": [         // æœç´¢å‚è€ƒï¼ˆä½¿ç”¨æœç´¢æ—¶ï¼‰
    {
      "title": "å‚è€ƒæ ‡é¢˜",
      "url": "å‚è€ƒURL",
      "relevance": "ç›¸å…³æ€§è¯´æ˜"
    }
  ],
  "thinking": "AIæ€è€ƒè¿‡ç¨‹",      // ä»…æµå¼æ¨¡å¼
  "search_queries": ["å…³é”®è¯"]   // æœç´¢å…³é”®è¯åˆ—è¡¨
}
```

## é…ç½®é€‰é¡¹

### Python Bridge é…ç½®

åœ¨ `src/main/llmService.js` ä¸­ï¼š

```javascript
this.pythonBridge = new PythonBridge({
  pythonPath: 'python3',      // Python å¯æ‰§è¡Œæ–‡ä»¶
  timeout: 120000,            // è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
  maxRetries: 3,              // æœ€å¤§é‡è¯•æ¬¡æ•°
  poolSize: 2                 // è¿›ç¨‹æ± å¤§å°
});
```

## æ€§èƒ½ä¼˜åŒ–

1. **è¿›ç¨‹æ± **ï¼šé¢„åˆ›å»º Python è¿›ç¨‹ï¼Œé¿å…å¯åŠ¨å¼€é”€ï¼ˆ~100-200msï¼‰
2. **è¯·æ±‚é˜Ÿåˆ—**ï¼šç®¡ç†å¹¶å‘ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½
3. **å¼‚æ­¥å¤„ç†**ï¼šéé˜»å¡è°ƒç”¨ï¼Œæé«˜å“åº”é€Ÿåº¦
4. **è‡ªåŠ¨é‡è¯•**ï¼šç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•ï¼Œæé«˜æˆåŠŸç‡

## é”™è¯¯å¤„ç†

ç³»ç»Ÿå®ç°äº†ä¸‰å±‚é”™è¯¯å¤„ç†ï¼š

1. **Python å±‚**ï¼šæ•è· API é”™è¯¯ï¼Œè¿”å›ç»“æ„åŒ–ä¿¡æ¯
2. **Bridge å±‚**ï¼šé‡è¯•æœºåˆ¶ã€è¶…æ—¶ä¿æŠ¤ã€è¿›ç¨‹ç®¡ç†
3. **Service å±‚**ï¼šç»Ÿä¸€é”™è¯¯æ ¼å¼ã€æ—¥å¿—è®°å½•

## æ–‡æ¡£

- [Python é›†æˆæ–‡æ¡£](./docs/PYTHON_INTEGRATION.md)
- [API å‚è€ƒæ–‡æ¡£](./docs/API.md)
- [1.md](./1.md) - è¾¹æƒ³è¾¹æœä½¿ç”¨ç¤ºä¾‹

## æµ‹è¯•

### æµ‹è¯• Python æœåŠ¡

```bash
# åŸºæœ¬æµ‹è¯•
echo '{"text":"æµ‹è¯•å†…å®¹","imageUrls":[],"sourceUrl":"","useWebSearch":false,"stream":false}' | python3 python/llm_service.py

# ä½¿ç”¨ç½‘ç»œæœç´¢
echo '{"text":"2024å¹´å‘ç”Ÿäº†ä»€ä¹ˆå¤§äº‹ï¼Ÿ","imageUrls":[],"sourceUrl":"","useWebSearch":true,"stream":false}' | python3 python/llm_service.py
```

### æµ‹è¯• Node.js é›†æˆ

è¿è¡Œåº”ç”¨å¹¶ä½¿ç”¨ç•Œé¢æµ‹è¯•åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

- **Node.js**: ä¸»è¿›ç¨‹å’Œ IPC é€šä¿¡
- **Python**: AI æœåŠ¡å’Œ API è°ƒç”¨
- **Electron**: æ¡Œé¢åº”ç”¨æ¡†æ¶
- **OpenAI SDK**: API å®¢æˆ·ç«¯
- **ç«å±±æ–¹èˆŸ (Doubao)**: å¤§è¯­è¨€æ¨¡å‹æœåŠ¡

## å®‰å…¨æ€§

- âœ… è¾“å…¥éªŒè¯é˜²æ­¢æ³¨å…¥
- âœ… è¿›ç¨‹éš”ç¦»ä¿è¯ç¨³å®šæ€§
- âœ… API å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… é”™è¯¯ä¿¡æ¯ä¸æš´éœ²æ•æ„Ÿæ•°æ®

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
